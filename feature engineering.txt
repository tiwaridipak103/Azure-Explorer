# Feature transformation function
feature = ['price', 'tax']
groupby_col = ['fips_code', 'property_type']
columns_to_pct_change = {f: f + '_yoy' for f in feature}

def feature_transformation(df, groupby_col):
    df = df.sort_values(groupby_col + ['date'])  # Ensure proper sorting

    columns_to_pct_change_qoq = {f: f + '_qoq' for f in feature}
    pct_change_qoq = df.groupby(groupby_col)[feature].pct_change(periods=1) 

    pct_change_qoq.rename(columns=columns_to_pct_change_qoq, inplace=True)  # Rename columns

    columns_to_pct_change_yoy = {f: f + '_yoy' for f in feature}
    pct_change_yoy = df.groupby(groupby_col)[feature].pct_change(periods=4) 
    pct_change_yoy.rename(columns=columns_to_pct_change_yoy, inplace=True)  # Rename columns

    df_new = pd.concat([df, pct_change_qoq, pct_change_yoy ] , axis=1) 
    return df_new

# Apply feature transformation
df_new = feature_transformation(df, groupby_col)

print(df_new)
