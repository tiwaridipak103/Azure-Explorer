import psutil
import matplotlib.pyplot as plt
import time

# Enable interactive mode
plt.ion()

# Initialize the plot only once
fig, ax = plt.subplots()
bars = ax.bar(range(psutil.cpu_count()), [0] * psutil.cpu_count(), color='blue')

ax.set_ylim(0, 100)
ax.set_xlabel("CPU Core")
ax.set_ylabel("Usage (%)")
ax.set_title("Live CPU Usage per Core")

def test(core_id):
    cpu_usage = psutil.cpu_percent(percpu=True)  # Get CPU usage for each core

    for bar, usage in zip(bars, cpu_usage):  # Update bar heights
        bar.set_height(usage)

    fig.canvas.draw()  # Redraw the plot
    fig.canvas.flush_events()  # Flush events for live update

while True:
    test(45)  # Call the function
    time.sleep(2)  # Wait before updating again